<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="//stuff.poteland.com/css/stuff.min.css">
        <script src="//stuff.poteland.com/js/react.min.js"></script>
        <script src="//stuff.poteland.com/js/JSXTransformer.js"></script>
        <title>pote's box of crap</title>
    </head>
    <body>
        <ul class="downloads">
          <li class="top">Size: __FILESIZE__</li>
          <li><a id="direct-link" href="__PATH__">Direct Link</a></li>
          <li><a id="torrent" href="__PATH__?torrent">BitTorrent</a></li>
        </ul>

        <section id="rich-preview">
          __PREVIEW__
        </section>
    </body>

    <script type="text/jsx">
      var audioFormats = {
        mp3: 'audio/mpeg',
        ogg: 'audio/ogg',
        wav: 'audio/wav'
      }

      var dropName = document.querySelector("#direct-link").href

      var AudioPreview = React.createClass({
        render: function() {
          return(
            <audio controls>
              <source src={this.props.path} mime={this.props.mime}/>
              Your browser is unable to play this type of file, you can still download it though! :)
            </audio>
          );
        }
      });

      var videoFormats = {
        mov:  'video/mp4',
        mp4:  'video/mp4',
        webm: 'video/webm',
        ogg: 'video/ogg',
      }

      var VideoPreview = React.createClass({
        render: function() {
          return(
            <video controls>
              <source src={this.props.path} mime={this.props.mime}/>
              Your browser is unable to play this type of file, you can still download it though! :)
            </video>
          );
        }
      });

      Object.keys(audioFormats).forEach(function(format) {
        if (dropName.match(new RegExp(format + "$", "i"))) {
          React.render(
            <AudioPreview path="__PATH__" mime={audioFormats[format]} />,
            document.getElementById('rich-preview')
          );
        }
      });

      Object.keys(videoFormats).forEach(function(format) {
        if (dropName.match(new RegExp(format + "$", "i"))) {
          React.render(
            <VideoPreview path="__PATH__" mime={audioFormats[format]} />,
            document.getElementById('rich-preview')
          );
        }
      });
    </script>
</html>
